{"file_contents":{"utils/crop_advisory.py":{"content":"def get_crop_recommendation(season, soil_type, state=\"Kerala\"):\n    \"\"\"\n    Rule-based crop recommendation system\n    \"\"\"\n    \n    # Define crop database with characteristics\n    crops_db = {\n        \"Rice\": {\n            \"seasons\": [\"Kharif (Monsoon)\", \"Rabi (Winter)\"],\n            \"soil_types\": [\"Clay\", \"Loamy\", \"Alluvial\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"High\",\n            \"duration\": \"120-150 days\"\n        },\n        \"Coconut\": {\n            \"seasons\": [\"All Season\"],\n            \"soil_types\": [\"Sandy\", \"Loamy\", \"Red Soil\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"Medium\",\n            \"duration\": \"Perennial\"\n        },\n        \"Pepper\": {\n            \"seasons\": [\"Kharif (Monsoon)\"],\n            \"soil_types\": [\"Red Soil\", \"Loamy\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"Medium\",\n            \"duration\": \"Perennial\"\n        },\n        \"Banana\": {\n            \"seasons\": [\"All Season\"],\n            \"soil_types\": [\"Loamy\", \"Alluvial\", \"Red Soil\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"High\",\n            \"duration\": \"12-15 months\"\n        },\n        \"Cardamom\": {\n            \"seasons\": [\"Kharif (Monsoon)\"],\n            \"soil_types\": [\"Red Soil\", \"Loamy\"],\n            \"states\": [\"Kerala\"],\n            \"water_req\": \"High\",\n            \"duration\": \"Perennial\"\n        },\n        \"Rubber\": {\n            \"seasons\": [\"All Season\"],\n            \"soil_types\": [\"Red Soil\", \"Loamy\"],\n            \"states\": [\"Kerala\"],\n            \"water_req\": \"High\",\n            \"duration\": \"Perennial\"\n        },\n        \"Tapioca\": {\n            \"seasons\": [\"Kharif (Monsoon)\", \"Zaid (Summer)\"],\n            \"soil_types\": [\"Red Soil\", \"Sandy\", \"Loamy\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"Low\",\n            \"duration\": \"8-10 months\"\n        },\n        \"Ginger\": {\n            \"seasons\": [\"Kharif (Monsoon)\"],\n            \"soil_types\": [\"Loamy\", \"Red Soil\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"Medium\",\n            \"duration\": \"8-10 months\"\n        },\n        \"Turmeric\": {\n            \"seasons\": [\"Kharif (Monsoon)\"],\n            \"soil_types\": [\"Loamy\", \"Red Soil\", \"Clay\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"Medium\",\n            \"duration\": \"7-10 months\"\n        },\n        \"Arecanut\": {\n            \"seasons\": [\"All Season\"],\n            \"soil_types\": [\"Loamy\", \"Red Soil\"],\n            \"states\": [\"Kerala\"],\n            \"water_req\": \"High\",\n            \"duration\": \"Perennial\"\n        },\n        \"Cashew\": {\n            \"seasons\": [\"All Season\"],\n            \"soil_types\": [\"Red Soil\", \"Sandy\"],\n            \"states\": [\"Kerala\", \"All\"],\n            \"water_req\": \"Low\",\n            \"duration\": \"Perennial\"\n        },\n        \"Cocoa\": {\n            \"seasons\": [\"All Season\"],\n            \"soil_types\": [\"Loamy\", \"Red Soil\"],\n            \"states\": [\"Kerala\"],\n            \"water_req\": \"Medium\",\n            \"duration\": \"Perennial\"\n        }\n    }\n    \n    # Additional crops for different seasons\n    if season == \"Rabi (Winter)\":\n        additional_crops = {\n            \"Wheat\": {\n                \"seasons\": [\"Rabi (Winter)\"],\n                \"soil_types\": [\"Loamy\", \"Alluvial\", \"Clay\"],\n                \"states\": [\"All\"],\n                \"water_req\": \"Medium\",\n                \"duration\": \"120-150 days\"\n            },\n            \"Barley\": {\n                \"seasons\": [\"Rabi (Winter)\"],\n                \"soil_types\": [\"Loamy\", \"Sandy\"],\n                \"states\": [\"All\"],\n                \"water_req\": \"Low\",\n                \"duration\": \"120-140 days\"\n            },\n            \"Mustard\": {\n                \"seasons\": [\"Rabi (Winter)\"],\n                \"soil_types\": [\"Loamy\", \"Sandy\"],\n                \"states\": [\"All\"],\n                \"water_req\": \"Low\",\n                \"duration\": \"90-120 days\"\n            }\n        }\n        crops_db.update(additional_crops)\n    \n    if season == \"Zaid (Summer)\":\n        summer_crops = {\n            \"Watermelon\": {\n                \"seasons\": [\"Zaid (Summer)\"],\n                \"soil_types\": [\"Sandy\", \"Loamy\"],\n                \"states\": [\"All\"],\n                \"water_req\": \"High\",\n                \"duration\": \"90-100 days\"\n            },\n            \"Muskmelon\": {\n                \"seasons\": [\"Zaid (Summer)\"],\n                \"soil_types\": [\"Sandy\", \"Loamy\"],\n                \"states\": [\"All\"],\n                \"water_req\": \"Medium\",\n                \"duration\": \"90-110 days\"\n            },\n            \"Cucumber\": {\n                \"seasons\": [\"Zaid (Summer)\"],\n                \"soil_types\": [\"Loamy\", \"Sandy\"],\n                \"states\": [\"All\"],\n                \"water_req\": \"High\",\n                \"duration\": \"50-70 days\"\n            }\n        }\n        crops_db.update(summer_crops)\n    \n    # Find suitable crops\n    primary_crops = []\n    secondary_crops = []\n    \n    for crop_name, crop_info in crops_db.items():\n        # Check season compatibility\n        season_match = (season in crop_info[\"seasons\"] or \n                       \"All Season\" in crop_info[\"seasons\"])\n        \n        # Check soil compatibility  \n        soil_match = soil_type in crop_info[\"soil_types\"]\n        \n        # Check state compatibility\n        state_match = (state in crop_info[\"states\"] or \n                      \"All\" in crop_info[\"states\"])\n        \n        if season_match and soil_match and state_match:\n            crop_rec = {\n                \"name\": crop_name,\n                \"reason\": f\"Suitable for {season.split('(')[0].strip()} season in {soil_type.lower()} soil\",\n                \"water_requirement\": crop_info[\"water_req\"],\n                \"duration\": crop_info[\"duration\"]\n            }\n            primary_crops.append(crop_rec)\n        elif season_match and state_match:  # Partially suitable\n            crop_rec = {\n                \"name\": crop_name,\n                \"reason\": f\"May work with soil management for {season.split('(')[0].strip()} season\",\n                \"water_requirement\": crop_info[\"water_req\"], \n                \"duration\": crop_info[\"duration\"]\n            }\n            secondary_crops.append(crop_rec)\n    \n    # Generate farming tips based on season and soil\n    tips = generate_farming_tips(season, soil_type, state)\n    \n    return {\n        \"primary_crops\": primary_crops[:5],  # Top 5 recommendations\n        \"secondary_crops\": secondary_crops[:3],  # Top 3 alternatives\n        \"tips\": tips\n    }\n\ndef generate_farming_tips(season, soil_type, state):\n    \"\"\"\n    Generate contextual farming tips\n    \"\"\"\n    tips = []\n    \n    # Season-specific tips\n    if \"Monsoon\" in season:\n        tips.extend([\n            \"Ensure proper drainage to prevent waterlogging\",\n            \"Monitor for fungal diseases due to high humidity\",\n            \"Plant at the right time to utilize monsoon rains effectively\"\n        ])\n    elif \"Winter\" in season:\n        tips.extend([\n            \"Protect crops from frost in colder regions\",\n            \"Irrigation requirements are generally lower\",\n            \"Good time for harvesting kharif crops\"\n        ])\n    elif \"Summer\" in season:\n        tips.extend([\n            \"Ensure adequate irrigation systems\",\n            \"Use mulching to conserve soil moisture\",\n            \"Consider drought-resistant varieties\"\n        ])\n    \n    # Soil-specific tips\n    soil_tips = {\n        \"Clay\": [\n            \"Improve drainage by adding organic matter\",\n            \"Avoid working the soil when it's too wet\",\n            \"Clay soils retain nutrients well but may need better aeration\"\n        ],\n        \"Sandy\": [\n            \"Add organic matter to improve water retention\",\n            \"More frequent but lighter irrigation needed\",\n            \"Regular fertilization required as nutrients leach quickly\"\n        ],\n        \"Loamy\": [\n            \"Ideal soil type for most crops\",\n            \"Maintain organic matter levels with compost\",\n            \"Well-balanced nutrition and water retention\"\n        ],\n        \"Red Soil\": [\n            \"May need lime to reduce acidity\",\n            \"Add phosphorus-rich fertilizers\",\n            \"Good for perennial crops like coconut and cashew\"\n        ],\n        \"Black Soil\": [\n            \"Excellent for cotton and sugarcane\",\n            \"Rich in nutrients but may have drainage issues\",\n            \"Deep plowing recommended\"\n        ],\n        \"Alluvial\": [\n            \"Very fertile and suitable for cereals\",\n            \"Regular flooding areas - plan accordingly\",\n            \"Rich in potash but may need phosphorus\"\n        ]\n    }\n    \n    if soil_type in soil_tips:\n        tips.extend(soil_tips[soil_type])\n    \n    # State-specific tips for Kerala\n    if state == \"Kerala\":\n        tips.extend([\n            \"Take advantage of two monsoon seasons\",\n            \"Intercropping with spices can increase income\",\n            \"Consider organic farming for premium prices\"\n        ])\n    \n    return tips[:8]  # Return top 8 tips\n\ndef get_seasonal_calendar(state=\"Kerala\"):\n    \"\"\"\n    Get crop calendar for the specified state\n    \"\"\"\n    calendar = {\n        \"Kharif (June-October)\": [\n            \"Rice (June-July planting)\",\n            \"Ginger (April-June planting)\",\n            \"Turmeric (April-June planting)\",\n            \"Pepper (June-July planting)\"\n        ],\n        \"Rabi (November-March)\": [\n            \"Rice (November-December planting)\",\n            \"Vegetables (October-December planting)\",\n            \"Pulses (October-November planting)\"\n        ],\n        \"Summer (April-June)\": [\n            \"Tapioca (March-May planting)\",\n            \"Vegetables (February-April planting)\",\n            \"Watermelon (February-March planting)\"\n        ],\n        \"Perennial Crops\": [\n            \"Coconut (Year-round)\",\n            \"Rubber (Year-round)\",\n            \"Arecanut (Year-round)\",\n            \"Cashew (Year-round)\"\n        ]\n    }\n    \n    return calendar\n","size_bytes":9960},"utils/farming_calendar.py":{"content":"from datetime import datetime, timedelta\nimport json\nimport os\n\ndef get_crop_calendar(crop_name, planting_date=None):\n    \"\"\"Get farming calendar for a specific crop\"\"\"\n    \n    crop_schedules = {\n        'Rice (Paddy)': {\n            'duration_days': 120,\n            'stages': [\n                {'name': 'Land Preparation', 'days': 7, 'activities': ['Ploughing', 'Leveling', 'Bund repair']},\n                {'name': 'Nursery Preparation', 'days': 25, 'activities': ['Seed treatment', 'Nursery bed preparation', 'Sowing']},\n                {'name': 'Transplanting', 'days': 5, 'activities': ['Field preparation', 'Transplant seedlings', 'Gap filling']},\n                {'name': 'Vegetative Stage', 'days': 40, 'activities': ['Irrigation', 'Weeding', 'First fertilizer dose']},\n                {'name': 'Reproductive Stage', 'days': 30, 'activities': ['Second fertilizer dose', 'Pest monitoring', 'Disease control']},\n                {'name': 'Maturity & Harvest', 'days': 13, 'activities': ['Stop irrigation', 'Harvesting', 'Threshing']}\n            ],\n            'fertilizer_schedule': [\n                {'days': 15, 'fertilizer': 'Urea - 25 kg/acre', 'stage': 'After transplanting'},\n                {'days': 40, 'fertilizer': 'Urea - 25 kg/acre', 'stage': 'Tillering stage'},\n                {'days': 60, 'fertilizer': 'Urea - 15 kg/acre', 'stage': 'Panicle initiation'}\n            ]\n        },\n        'Coconut': {\n            'duration_days': 365,\n            'stages': [\n                {'name': 'Year-round Care', 'days': 365, 'activities': ['Regular watering', 'Manuring', 'Pest control']}\n            ],\n            'fertilizer_schedule': [\n                {'days': 90, 'fertilizer': 'Organic manure - 25 kg/palm', 'stage': 'Pre-monsoon'},\n                {'days': 180, 'fertilizer': 'NPK - 1.3 kg/palm', 'stage': 'Monsoon'},\n                {'days': 270, 'fertilizer': 'Organic manure - 25 kg/palm', 'stage': 'Post-monsoon'}\n            ]\n        },\n        'Pepper': {\n            'duration_days': 240,\n            'stages': [\n                {'name': 'Planting', 'days': 15, 'activities': ['Pit preparation', 'Planting cuttings', 'Mulching']},\n                {'name': 'Establishment', 'days': 60, 'activities': ['Regular watering', 'Training vines', 'Mulching']},\n                {'name': 'Vegetative Growth', 'days': 90, 'activities': ['Fertilizer application', 'Pruning', 'Pest control']},\n                {'name': 'Flowering & Fruiting', 'days': 75, 'activities': ['Increased irrigation', 'Nutrient spray', 'Disease control']}\n            ],\n            'fertilizer_schedule': [\n                {'days': 45, 'fertilizer': 'Organic manure - 10 kg/vine', 'stage': 'After planting'},\n                {'days': 120, 'fertilizer': 'NPK - 100:60:140 g/vine', 'stage': 'Growth stage'},\n                {'days': 180, 'fertilizer': 'NPK - 100:60:140 g/vine', 'stage': 'Flowering stage'}\n            ]\n        },\n        'Banana': {\n            'duration_days': 365,\n            'stages': [\n                {'name': 'Planting', 'days': 15, 'activities': ['Pit preparation', 'Sucker selection', 'Planting']},\n                {'name': 'Vegetative Phase', 'days': 120, 'activities': ['Irrigation', 'Mulching', 'Earthing up']},\n                {'name': 'Flowering Phase', 'days': 90, 'activities': ['Bunch care', 'Propping', 'Denavelling']},\n                {'name': 'Fruiting & Harvest', 'days': 140, 'activities': ['Bunch covering', 'Harvesting', 'Post-harvest']}\n            ],\n            'fertilizer_schedule': [\n                {'days': 30, 'fertilizer': 'FYM - 10 kg/plant', 'stage': 'After planting'},\n                {'days': 60, 'fertilizer': 'NPK - 200:100:300 g/plant', 'stage': 'Vegetative'},\n                {'days': 120, 'fertilizer': 'NPK - 200:100:300 g/plant', 'stage': 'Pre-flowering'}\n            ]\n        }\n    }\n    \n    if crop_name not in crop_schedules:\n        crop_name = 'Rice (Paddy)'  # Default\n    \n    schedule = crop_schedules[crop_name]\n    \n    if planting_date is None:\n        planting_date = datetime.now()\n    elif isinstance(planting_date, str):\n        planting_date = datetime.fromisoformat(planting_date)\n    \n    # Generate timeline\n    timeline = []\n    current_date = planting_date\n    \n    for stage in schedule['stages']:\n        end_date = current_date + timedelta(days=stage['days'])\n        timeline.append({\n            'stage': stage['name'],\n            'start_date': current_date.strftime('%Y-%m-%d'),\n            'end_date': end_date.strftime('%Y-%m-%d'),\n            'duration_days': stage['days'],\n            'activities': stage['activities']\n        })\n        current_date = end_date\n    \n    # Generate fertilizer schedule\n    fertilizer_timeline = []\n    for fert in schedule['fertilizer_schedule']:\n        fert_date = planting_date + timedelta(days=fert['days'])\n        fertilizer_timeline.append({\n            'date': fert_date.strftime('%Y-%m-%d'),\n            'fertilizer': fert['fertilizer'],\n            'stage': fert['stage']\n        })\n    \n    return {\n        'crop': crop_name,\n        'planting_date': planting_date.strftime('%Y-%m-%d'),\n        'harvest_date': (planting_date + timedelta(days=schedule['duration_days'])).strftime('%Y-%m-%d'),\n        'total_duration': schedule['duration_days'],\n        'timeline': timeline,\n        'fertilizer_schedule': fertilizer_timeline\n    }\n\ndef get_user_reminders(mobile):\n    \"\"\"Get reminders for a user\"\"\"\n    from utils.auth_helper import get_user_data\n    \n    user_data = get_user_data(mobile)\n    if not user_data:\n        return []\n    \n    return user_data.get('reminders', [])\n\ndef add_reminder(mobile, reminder_data):\n    \"\"\"Add a reminder for user\"\"\"\n    from utils.auth_helper import get_user_data, update_user_data\n    \n    user_data = get_user_data(mobile)\n    if not user_data:\n        return False\n    \n    reminders = user_data.get('reminders', [])\n    reminders.append({\n        'id': len(reminders) + 1,\n        'created_at': datetime.now().isoformat(),\n        **reminder_data\n    })\n    \n    update_user_data(mobile, {'reminders': reminders})\n    return True\n\ndef get_upcoming_tasks(mobile, days=7):\n    \"\"\"Get upcoming farming tasks for user\"\"\"\n    from utils.auth_helper import get_user_data\n    \n    user_data = get_user_data(mobile)\n    if not user_data:\n        return []\n    \n    upcoming_tasks = []\n    today = datetime.now()\n    \n    # Check reminders\n    for reminder in user_data.get('reminders', []):\n        reminder_date = datetime.fromisoformat(reminder['date'])\n        days_until = (reminder_date - today).days\n        \n        if 0 <= days_until <= days:\n            upcoming_tasks.append({\n                'type': 'reminder',\n                'date': reminder['date'],\n                'days_until': days_until,\n                'title': reminder['title'],\n                'description': reminder.get('description', '')\n            })\n    \n    # Check crop calendars\n    for crop in user_data.get('crops', []):\n        calendar = get_crop_calendar(crop['name'], crop['planting_date'])\n        \n        # Check fertilizer schedule\n        for fert in calendar['fertilizer_schedule']:\n            fert_date = datetime.fromisoformat(fert['date'])\n            days_until = (fert_date - today).days\n            \n            if 0 <= days_until <= days:\n                upcoming_tasks.append({\n                    'type': 'fertilizer',\n                    'date': fert['date'],\n                    'days_until': days_until,\n                    'title': f\"{crop['name']} - Fertilizer Application\",\n                    'description': fert['fertilizer']\n                })\n        \n        # Check stage transitions\n        for stage in calendar['timeline']:\n            stage_date = datetime.fromisoformat(stage['end_date'])\n            days_until = (stage_date - today).days\n            \n            if 0 <= days_until <= days:\n                upcoming_tasks.append({\n                    'type': 'stage',\n                    'date': stage['end_date'],\n                    'days_until': days_until,\n                    'title': f\"{crop['name']} - {stage['stage']} Complete\",\n                    'description': ', '.join(stage['activities'])\n                })\n    \n    # Sort by date\n    upcoming_tasks.sort(key=lambda x: x['days_until'])\n    \n    return upcoming_tasks\n\ndef add_crop_to_user(mobile, crop_name, planting_date, area_acres):\n    \"\"\"Add a crop to user's farming calendar\"\"\"\n    from utils.auth_helper import get_user_data, update_user_data\n    \n    user_data = get_user_data(mobile)\n    if not user_data:\n        return False\n    \n    crops = user_data.get('crops', [])\n    crops.append({\n        'name': crop_name,\n        'planting_date': planting_date,\n        'area_acres': area_acres,\n        'added_at': datetime.now().isoformat()\n    })\n    \n    update_user_data(mobile, {'crops': crops})\n    return True\n","size_bytes":8880},"replit.md":{"content":"# Krishi Mitra AI - Agricultural Assistant Application\n\n## Overview\n\nKrishi Mitra AI is a comprehensive agricultural assistant application designed for Indian farmers. The application provides AI-powered farming advice, crop recommendations, weather information, agricultural news, disease diagnosis through image analysis, and information about government schemes. Built with Streamlit for the web interface, it integrates multiple external services to deliver a unified farming support platform with multilingual capabilities.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: Streamlit-based web application with wide layout configuration\n- **State Management**: Session-based state management for tracking user interactions, chat history, language preferences, and voice queries\n- **User Interface Components**:\n  - Multi-section navigation (Ask AI, Weather, Crop Advisory, News, Schemes)\n  - Chat interface with persistent history\n  - Voice input capability with audio file processing\n  - Image upload and analysis for disease detection\n  - Responsive layout with sidebar navigation\n\n### Backend Architecture\n- **Modular Design**: Utility-based architecture with specialized helper modules:\n  - `gemini_helper.py`: AI-powered query processing and image analysis\n  - `weather_helper.py`: Weather data retrieval and processing\n  - `crop_advisory.py`: Rule-based crop recommendation engine\n  - `news_helper.py`: Agricultural news aggregation with fallback mechanism\n  \n- **AI Integration**: Google Gemini API (gemini-2.5-flash model) serves as the core AI engine with:\n  - Comprehensive agricultural knowledge base\n  - Multilingual support (English, Malayalam, Hindi, Marathi)\n  - Context-aware responses for Indian farming conditions\n  - Image analysis capabilities for crop disease detection\n\n- **Recommendation System**: Rule-based crop advisory system using:\n  - Season-based filtering (Kharif, Rabi, Zaid, All Season)\n  - Soil type compatibility (Clay, Loamy, Sandy, Red Soil, Alluvial)\n  - Regional/state-specific crop database\n  - Water requirement and duration metrics\n\n### Data Storage\n- **Static Data**: JSON-based storage for government schemes (`schemes.json`)\n- **Scheme Database Structure**: Contains comprehensive information including:\n  - Scheme details and eligibility criteria\n  - Benefits and application procedures\n  - State-specific applicability\n  - Contact information and deadlines\n- **Session State**: In-memory storage for chat history and user preferences (no persistent database)\n- **Crop Database**: In-code dictionary structure with crop characteristics and growing requirements\n\n### Multilingual Support\n- **Language Options**: English, Malayalam, Hindi, Marathi\n- **Implementation**: Language code mapping with automatic detection and response generation in target language\n- **Voice Input**: Speech recognition with language-specific processing using Google Speech Recognition API\n\n### Voice Processing\n- **Speech Recognition**: Uses `speech_recognition` library with Google's speech-to-text service\n- **Audio Handling**: Temporary file processing for uploaded audio files\n- **Error Handling**: Comprehensive exception handling for audio processing failures\n\n## External Dependencies\n\n### APIs and Services\n1. **Google Gemini API** (`google.genai`)\n   - Purpose: AI-powered agricultural query responses and image analysis\n   - Model: gemini-2.5-flash\n   - Authentication: API key via environment variable `GEMINI_API_KEY`\n   - Features: Text generation, image analysis for disease detection\n\n2. **OpenWeatherMap API**\n   - Purpose: Real-time weather data retrieval\n   - Endpoint: `api.openweathermap.org/data/2.5/weather`\n   - Authentication: API key via environment variable `OPENWEATHER_API_KEY`\n   - Data: Temperature, humidity, rainfall, wind speed, visibility, sunrise/sunset times\n\n3. **NewsAPI** (Optional)\n   - Purpose: Fetching latest agriculture-related news\n   - Authentication: API key via environment variable `NEWS_API_KEY`\n   - Fallback: Hardcoded curated news when API unavailable\n   - Query: Agriculture, farming, crops, farmers India-related news\n\n4. **Google Speech Recognition API**\n   - Purpose: Voice-to-text conversion for voice queries\n   - Library: `speech_recognition`\n   - Language Support: Multiple Indian languages via language codes\n\n### Python Libraries\n- **streamlit**: Web application framework\n- **google-genai**: Google Gemini AI client\n- **requests**: HTTP client for external API calls\n- **speech_recognition**: Voice input processing\n- **base64, io, tempfile**: File and data handling utilities\n- **datetime, json**: Data processing and formatting\n\n### Configuration Requirements\n- Environment variables for API keys (GEMINI_API_KEY, OPENWEATHER_API_KEY, NEWS_API_KEY)\n- Default fallback values for missing configurations\n- Timeout handling (10 seconds) for external API calls\n- Error handling with graceful degradation (fallback news, error messages)","size_bytes":5023},"utils/auth_helper.py":{"content":"import streamlit as st\nimport json\nimport os\nfrom datetime import datetime\nimport hashlib\n\ndef hash_password(password):\n    \"\"\"Hash password for storage\"\"\"\n    return hashlib.sha256(password.encode()).hexdigest()\n\ndef load_users():\n    \"\"\"Load users from JSON file\"\"\"\n    if os.path.exists('users.json'):\n        with open('users.json', 'r') as f:\n            return json.load(f)\n    return {}\n\ndef save_users(users):\n    \"\"\"Save users to JSON file\"\"\"\n    with open('users.json', 'w') as f:\n        json.dump(users, f, indent=2)\n\ndef register_user(name, location, mobile, password):\n    \"\"\"Register a new user\"\"\"\n    users = load_users()\n    \n    if mobile in users:\n        return False, \"Mobile number already registered\"\n    \n    users[mobile] = {\n        'name': name,\n        'location': location,\n        'mobile': mobile,\n        'password': hash_password(password),\n        'registered_at': datetime.now().isoformat(),\n        'crops': [],\n        'reminders': []\n    }\n    \n    save_users(users)\n    return True, \"Registration successful\"\n\ndef login_user(mobile, password):\n    \"\"\"Login user\"\"\"\n    users = load_users()\n    \n    if mobile not in users:\n        return False, \"Mobile number not found\"\n    \n    if users[mobile]['password'] != hash_password(password):\n        return False, \"Incorrect password\"\n    \n    return True, users[mobile]\n\ndef get_user_data(mobile):\n    \"\"\"Get user data by mobile number\"\"\"\n    users = load_users()\n    return users.get(mobile, None)\n\ndef update_user_data(mobile, data):\n    \"\"\"Update user data\"\"\"\n    users = load_users()\n    if mobile in users:\n        users[mobile].update(data)\n        save_users(users)\n        return True\n    return False\n","size_bytes":1695},"app.py":{"content":"import streamlit as st\nimport os\nfrom utils.gemini_helper import ask_gemini, analyze_image_for_disease\nfrom utils.weather_helper import get_weather_data\nfrom utils.crop_advisory import get_crop_recommendation\nfrom utils.news_helper import get_agriculture_news\nfrom utils.auth_helper import register_user, login_user, get_user_data\nfrom utils.market_prices import get_market_prices, get_market_insights, get_best_selling_time\nfrom utils.farming_calendar import get_crop_calendar, add_crop_to_user, get_upcoming_tasks, add_reminder\nimport json\nfrom datetime import datetime, timedelta\nimport base64\nimport speech_recognition as sr\nimport tempfile\nimport io\n\n# Page configuration\nst.set_page_config(\n    page_title=\"üåæ Krishi Mitra AI\",\n    page_icon=\"üåæ\",\n    layout=\"wide\",\n    initial_sidebar_state=\"expanded\"\n)\n\n# Initialize session state\nif 'current_section' not in st.session_state:\n    st.session_state.current_section = \"Ask AI\"\n\nif 'chat_history' not in st.session_state:\n    st.session_state.chat_history = []\n\nif 'language' not in st.session_state:\n    st.session_state.language = \"English\"\n\nif 'voice_query' not in st.session_state:\n    st.session_state.voice_query = \"\"\n\nif 'authenticated' not in st.session_state:\n    st.session_state.authenticated = False\n\nif 'user_mobile' not in st.session_state:\n    st.session_state.user_mobile = None\n\nif 'user_data' not in st.session_state:\n    st.session_state.user_data = None\n\ndef process_voice_input(audio_file, language_code):\n    \"\"\"Process voice input and convert to text\"\"\"\n    recognizer = sr.Recognizer()\n    \n    try:\n        with sr.AudioFile(audio_file) as source:\n            audio_data = recognizer.record(source)\n            text = recognizer.recognize_google(audio_data, language=language_code)\n            return text\n    except sr.UnknownValueError:\n        return \"Could not understand audio\"\n    except sr.RequestError as e:\n        return f\"Could not request results; {e}\"\n    except Exception as e:\n        return f\"Error: {str(e)}\"\n\n# Header\nif st.session_state.authenticated and st.session_state.user_data:\n    user_info = f\"üë®‚Äçüåæ {st.session_state.user_data['name']} ‚Äì {st.session_state.user_data['location']}\"\nelse:\n    user_info = \"üë®‚Äçüåæ Guest User\"\n\nst.markdown(f\"\"\"\n<div style=\"background-color: #4CAF50; padding: 20px; border-radius: 10px; margin-bottom: 20px;\">\n    <h1 style=\"color: white; text-align: center; margin: 0;\">üåæ Krishi Mitra AI ‚Äî Your Smart Farming Companion</h1>\n    <p style=\"color: white; text-align: center; margin: 10px 0 0 0; font-size: 18px;\">\n        {user_info}\n    </p>\n</div>\n\"\"\", unsafe_allow_html=True)\n\n# Language selector\nlanguages = {\"English\": \"en\", \"Malayalam\": \"ml\", \"Hindi\": \"hi\", \"Marathi\": \"mr\"}\n\n# UI translations\nui_translations = {\n    \"English\": {\n        \"select_language\": \"üåê Select Language\",\n        \"navigation\": \"Navigation\",\n        \"ask_ai\": \"üí¨ Ask AI\",\n        \"weather_info\": \"üå¶Ô∏è Weather Info\",\n        \"schemes\": \"üì¢ Schemes\",\n        \"crop_advisory\": \"üåæ Crop Advisory\",\n        \"news_feed\": \"üì∞ News Feed\",\n        \"market_prices\": \"üìà Market Prices\",\n        \"farming_calendar\": \"üìÖ My Calendar\",\n        \"login\": \"üîê Login/Signup\",\n        \"farming_assistant\": \"AI Farming Assistant\",\n        \"ask_questions\": \"Ask your farming questions\",\n        \"type_question\": \"Type your farming question here...\",\n        \"send\": \"üì§ Send\",\n        \"voice_input\": \"üé§ Voice Input\",\n        \"upload_audio\": \"Upload audio file (WAV format)\",\n        \"process_voice\": \"üé§ Process Voice Input\",\n        \"disease_detection\": \"üîç Crop Disease Detection\",\n        \"upload_image\": \"Upload crop image for disease analysis\",\n        \"analyze\": \"Analyze Disease\",\n        \"logout\": \"Logout\"\n    },\n    \"Hindi\": {\n        \"select_language\": \"üåê ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç\",\n        \"navigation\": \"‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§®\",\n        \"ask_ai\": \"üí¨ AI ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç\",\n        \"weather_info\": \"üå¶Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\",\n        \"schemes\": \"üì¢ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç\",\n        \"crop_advisory\": \"üåæ ‡§´‡§∏‡§≤ ‡§∏‡§≤‡§æ‡§π\",\n        \"news_feed\": \"üì∞ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞\",\n        \"market_prices\": \"üìà ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø\",\n        \"farming_calendar\": \"üìÖ ‡§Æ‡•á‡§∞‡§æ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞\",\n        \"login\": \"üîê ‡§≤‡•â‡§ó‡§ø‡§®/‡§∏‡§æ‡§á‡§®‡§Ö‡§™\",\n        \"farming_assistant\": \"‡§ï‡•É‡§∑‡§ø ‡§∏‡§π‡§æ‡§Ø‡§ï AI\",\n        \"ask_questions\": \"‡§Ö‡§™‡§®‡•á ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç\",\n        \"type_question\": \"‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§≤‡§ø‡§ñ‡•á‡§Ç...\",\n        \"send\": \"üì§ ‡§≠‡•á‡§ú‡•á‡§Ç\",\n        \"voice_input\": \"üé§ ‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü\",\n        \"upload_audio\": \"‡§ë‡§°‡§ø‡§Ø‡•ã ‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (WAV ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™)\",\n        \"process_voice\": \"üé§ ‡§µ‡•â‡§á‡§∏ ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡§∞‡•á‡§Ç\",\n        \"disease_detection\": \"üîç ‡§´‡§∏‡§≤ ‡§∞‡•ã‡§ó ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ‡§®‡§æ\",\n        \"upload_image\": \"‡§∞‡•ã‡§ó ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç\",\n        \"analyze\": \"‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç\",\n        \"logout\": \"‡§≤‡•â‡§ó‡§Ü‡§â‡§ü\"\n    },\n    \"Malayalam\": {\n        \"select_language\": \"üåê ‡¥≠‡¥æ‡¥∑ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï\",\n        \"navigation\": \"‡¥®‡¥æ‡¥µ‡¥ø‡¥ó‡µá‡¥∑‡µª\",\n        \"ask_ai\": \"üí¨ AI ‡¥Ø‡µã‡¥ü‡µç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï\",\n        \"weather_info\": \"üå¶Ô∏è ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥•‡¥æ ‡¥µ‡¥ø‡¥µ‡¥∞‡¥Ç\",\n        \"schemes\": \"üì¢ ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡µæ\",\n        \"crop_advisory\": \"üåæ ‡¥µ‡¥ø‡¥≥ ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥Ç\",\n        \"news_feed\": \"üì∞ ‡¥µ‡¥æ‡µº‡¥§‡µç‡¥§‡¥ï‡µæ\",\n        \"market_prices\": \"üìà ‡¥µ‡¥ø‡¥™‡¥£‡¥ø ‡¥µ‡¥ø‡¥≤\",\n        \"farming_calendar\": \"üìÖ ‡¥é‡¥®‡µç‡¥±‡µÜ ‡¥ï‡¥≤‡¥£‡µç‡¥ü‡µº\",\n        \"login\": \"üîê ‡¥≤‡µã‡¥ó‡¥ø‡µª/‡¥∏‡µà‡µª‡¥Ö‡¥™‡µç‡¥™‡µç\",\n        \"farming_assistant\": \"‡¥ï‡µÉ‡¥∑‡¥ø ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø AI\",\n        \"ask_questions\": \"‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥ô‡µç‡¥ô‡µæ ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï\",\n        \"type_question\": \"‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥ü‡µà‡¥™‡µç‡¥™‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï...\",\n        \"send\": \"üì§ ‡¥Ö‡¥Ø‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥ï\",\n        \"voice_input\": \"üé§ ‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥á‡µª‡¥™‡µÅ‡¥ü‡µç‡¥ü‡µç\",\n        \"upload_audio\": \"‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥´‡¥Ø‡µΩ ‡¥Ö‡¥™‡µç‚Äå‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï (WAV ‡¥´‡µã‡µº‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µç)\",\n        \"process_voice\": \"üé§ ‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥™‡µç‡¥∞‡µã‡¥∏‡¥∏‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï\",\n        \"disease_detection\": \"üîç ‡¥µ‡¥ø‡¥≥ ‡¥∞‡µã‡¥ó ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡µΩ\",\n        \"upload_image\": \"‡¥∞‡µã‡¥ó ‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥§‡µç‡¥§‡¥ø‡¥®‡¥æ‡¥Ø‡¥ø ‡¥µ‡¥ø‡¥≥ ‡¥ö‡¥ø‡¥§‡µç‡¥∞‡¥Ç ‡¥Ö‡¥™‡µç‚Äå‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï\",\n        \"analyze\": \"‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï\",\n        \"logout\": \"‡¥≤‡µã‡¥ó‡µó‡¥ü‡µç‡¥ü‡µç\"\n    },\n    \"Marathi\": {\n        \"select_language\": \"üåê ‡§≠‡§æ‡§∑‡§æ ‡§®‡§ø‡§µ‡§°‡§æ\",\n        \"navigation\": \"‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§∂‡§®\",\n        \"ask_ai\": \"üí¨ AI ‡§≤‡§æ ‡§µ‡§ø‡§ö‡§æ‡§∞‡§æ\",\n        \"weather_info\": \"üå¶Ô∏è ‡§π‡§µ‡§æ‡§Æ‡§æ‡§® ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä\",\n        \"schemes\": \"üì¢ ‡§Ø‡•ã‡§ú‡§®‡§æ\",\n        \"crop_advisory\": \"üåæ ‡§™‡•Ä‡§ï ‡§∏‡§≤‡•ç‡§≤‡§æ\",\n        \"news_feed\": \"üì∞ ‡§¨‡§æ‡§§‡§Æ‡•ç‡§Ø‡§æ\",\n        \"market_prices\": \"üìà ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡§ø‡§Ç‡§Æ‡§§\",\n        \"farming_calendar\": \"üìÖ ‡§Æ‡§æ‡§ù‡•á ‡§ï‡•Ö‡§≤‡•á‡§Ç‡§°‡§∞\",\n        \"login\": \"üîê ‡§≤‡•â‡§ó‡§ø‡§®/‡§∏‡§æ‡§á‡§®‡§Ö‡§™\",\n        \"farming_assistant\": \"‡§∂‡•á‡§§‡•Ä ‡§∏‡§π‡§æ‡§Ø‡•ç‡§Ø‡§ï AI\",\n        \"ask_questions\": \"‡§§‡•Å‡§Æ‡§ö‡•á ‡§∂‡•á‡§§‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§µ‡§ø‡§ö‡§æ‡§∞‡§æ\",\n        \"type_question\": \"‡§Ø‡•á‡§•‡•á ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§æ...\",\n        \"send\": \"üì§ ‡§™‡§æ‡§†‡§µ‡§æ\",\n        \"voice_input\": \"üé§ ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü\",\n        \"upload_audio\": \"‡§ë‡§°‡§ø‡§ì ‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ (WAV ‡§∏‡•ç‡§µ‡§∞‡•Ç‡§™)\",\n        \"process_voice\": \"üé§ ‡§µ‡•ç‡§π‡•â‡§á‡§∏ ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡§∞‡§æ\",\n        \"disease_detection\": \"üîç ‡§™‡•Ä‡§ï ‡§∞‡•ã‡§ó ‡§∂‡•ã‡§ß\",\n        \"upload_image\": \"‡§∞‡•ã‡§ó ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£‡§æ‡§∏‡§æ‡§†‡•Ä ‡§™‡•Ä‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ\",\n        \"analyze\": \"‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§æ\",\n        \"logout\": \"‡§≤‡•â‡§ó‡§Ü‡§â‡§ü\"\n    }\n}\n\ncurrent_lang = st.selectbox(\n    ui_translations[st.session_state.language][\"select_language\"] + \" / Select Language / ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç / ‡¥≠‡¥æ‡¥∑ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï / ‡§≠‡§æ‡§∑‡§æ ‡§®‡§ø‡§µ‡§°‡§æ\",\n    options=list(languages.keys()),\n    index=list(languages.keys()).index(st.session_state.language)\n)\n\nif current_lang != st.session_state.language:\n    st.session_state.language = current_lang\n    st.rerun()\n\n# Get current language translations\nt = ui_translations[st.session_state.language]\n\n# Sidebar navigation\nst.sidebar.title(t[\"navigation\"])\n\n# Login/Logout button\nif st.session_state.authenticated:\n    if st.sidebar.button(f\"üë§ {st.session_state.user_data['name']} - {t['logout']}\", key=\"logout_btn\"):\n        st.session_state.authenticated = False\n        st.session_state.user_mobile = None\n        st.session_state.user_data = None\n        st.session_state.current_section = \"Ask AI\"\n        st.rerun()\nelse:\n    if st.sidebar.button(t[\"login\"], key=\"login_btn\"):\n        st.session_state.current_section = \"Login\"\n\nst.sidebar.divider()\n\n# Main sections\nsections = [\n    (t[\"ask_ai\"], \"Ask AI\"),\n    (t[\"weather_info\"], \"Weather Info\"),\n    (t[\"schemes\"], \"Schemes\"),\n    (t[\"crop_advisory\"], \"Crop Advisory\"),\n    (t[\"news_feed\"], \"News Feed\"),\n    (t[\"market_prices\"], \"Market Prices\"),\n]\n\n# Add authenticated-only sections\nif st.session_state.authenticated:\n    sections.append((t[\"farming_calendar\"], \"Farming Calendar\"))\n\nfor display_name, section_key in sections:\n    if st.sidebar.button(display_name, key=section_key):\n        st.session_state.current_section = section_key\n\n# Main content area\nif st.session_state.current_section == \"Ask AI\":\n    st.header(t[\"farming_assistant\"])\n    \n    # Chat interface\n    st.subheader(t[\"ask_questions\"])\n    \n    # Display chat history\n    for chat in st.session_state.chat_history:\n        with st.container():\n            st.markdown(f\"**You:** {chat['question']}\")\n            st.markdown(f\"**Krishi Mitra:** {chat['answer']}\")\n            st.divider()\n    \n    # Language code mapping for speech recognition\n    speech_lang_codes = {\n        \"English\": \"en-IN\",\n        \"Malayalam\": \"ml-IN\",\n        \"Hindi\": \"hi-IN\",\n        \"Marathi\": \"mr-IN\"\n    }\n    \n    # Voice input section\n    st.subheader(t[\"voice_input\"])\n    audio_file = st.file_uploader(t[\"upload_audio\"], type=['wav'], key=\"audio_upload\")\n    \n    if audio_file is not None:\n        if st.button(t[\"process_voice\"]):\n            with st.spinner(\"Processing voice input...\"):\n                try:\n                    with tempfile.NamedTemporaryFile(delete=False, suffix='.wav') as tmp_file:\n                        tmp_file.write(audio_file.getvalue())\n                        tmp_file_path = tmp_file.name\n                    \n                    voice_text = process_voice_input(tmp_file_path, speech_lang_codes[st.session_state.language])\n                    st.session_state.voice_query = voice_text\n                    st.success(f\"Recognized: {voice_text}\")\n                    \n                    os.unlink(tmp_file_path)\n                except Exception as e:\n                    st.error(f\"Error processing voice: {str(e)}\")\n    \n    # Text input or use voice query\n    user_query = st.text_input(\n        t[\"type_question\"], \n        value=st.session_state.voice_query,\n        key=\"chat_input\"\n    )\n    \n    if st.button(t[\"send\"]):\n        if user_query:\n            with st.spinner(\"Getting AI response...\"):\n                try:\n                    response = ask_gemini(user_query, languages[st.session_state.language])\n                    st.session_state.chat_history.append({\n                        \"question\": user_query,\n                        \"answer\": response\n                    })\n                    st.session_state.voice_query = \"\"\n                    st.rerun()\n                except Exception as e:\n                    st.error(f\"Error getting AI response: {str(e)}\")\n    \n    # Image upload for disease detection\n    st.subheader(t[\"disease_detection\"])\n    uploaded_file = st.file_uploader(t[\"upload_image\"], type=['jpg', 'jpeg', 'png'])\n    \n    if uploaded_file is not None:\n        st.image(uploaded_file, caption=\"Uploaded Image\", width=300)\n        \n        if st.button(t[\"analyze\"]):\n            with st.spinner(\"Analyzing image...\"):\n                try:\n                    # Save uploaded file temporarily\n                    with open(\"temp_image.jpg\", \"wb\") as f:\n                        f.write(uploaded_file.getvalue())\n                    \n                    analysis = analyze_image_for_disease(\"temp_image.jpg\", languages[st.session_state.language])\n                    st.success(\"Analysis Complete!\")\n                    st.write(analysis)\n                    \n                    # Clean up temp file\n                    if os.path.exists(\"temp_image.jpg\"):\n                        os.remove(\"temp_image.jpg\")\n                        \n                except Exception as e:\n                    st.error(f\"Error analyzing image: {str(e)}\")\n\nelif st.session_state.current_section == \"Weather Info\":\n    st.header(\"üå¶Ô∏è Weather Information\")\n    \n    location = \"Palakkad,Kerala,IN\"\n    \n    try:\n        weather_data = get_weather_data(location)\n        \n        if weather_data:\n            col1, col2, col3, col4 = st.columns(4)\n            \n            with col1:\n                st.metric(\n                    label=\"üå°Ô∏è Temperature\",\n                    value=f\"{weather_data['temperature']}¬∞C\",\n                    delta=None\n                )\n            \n            with col2:\n                st.metric(\n                    label=\"üíß Humidity\",\n                    value=f\"{weather_data['humidity']}%\",\n                    delta=None\n                )\n            \n            with col3:\n                st.metric(\n                    label=\"üåßÔ∏è Rainfall\",\n                    value=f\"{weather_data.get('rainfall', 0)} mm\",\n                    delta=None\n                )\n            \n            with col4:\n                st.metric(\n                    label=\"üí® Wind Speed\",\n                    value=f\"{weather_data.get('wind_speed', 0)} km/h\",\n                    delta=None\n                )\n            \n            st.subheader(\"Current Conditions\")\n            st.write(f\"**Weather:** {weather_data['description']}\")\n            st.write(f\"**Feels like:** {weather_data.get('feels_like', weather_data['temperature'])}¬∞C\")\n            \n            # Weather advisory\n            st.subheader(\"üßë‚Äçüåæ Farming Advisory\")\n            if weather_data['humidity'] > 80:\n                st.warning(\"‚ö†Ô∏è High humidity detected. Monitor crops for fungal diseases.\")\n            if weather_data['temperature'] > 35:\n                st.warning(\"üå°Ô∏è High temperature. Ensure adequate irrigation.\")\n            if weather_data.get('rainfall', 0) > 10:\n                st.info(\"üåßÔ∏è Good rainfall. Perfect for rice cultivation.\")\n        else:\n            st.error(\"Unable to fetch weather data. Please check your internet connection.\")\n            \n    except Exception as e:\n        st.error(f\"Error fetching weather data: {str(e)}\")\n\nelif st.session_state.current_section == \"Schemes\":\n    st.header(\"üì¢ Government Schemes\")\n    \n    try:\n        with open('schemes.json', 'r', encoding='utf-8') as f:\n            schemes_data = json.load(f)\n        \n        # Filter schemes for Kerala\n        kerala_schemes = [scheme for scheme in schemes_data['schemes'] \n                         if 'Kerala' in scheme.get('applicable_states', []) or 'All States' in scheme.get('applicable_states', [])]\n        \n        st.subheader(f\"Available Schemes for Kerala ({len(kerala_schemes)} schemes)\")\n        \n        for scheme in kerala_schemes:\n            with st.expander(f\"üéØ {scheme['title']}\"):\n                st.write(f\"**Description:** {scheme['description']}\")\n                st.write(f\"**Eligibility:** {scheme['eligibility']}\")\n                st.write(f\"**Benefits:** {scheme['benefits']}\")\n                st.write(f\"**How to Apply:** {scheme['how_to_apply']}\")\n                \n                if scheme.get('deadline'):\n                    st.write(f\"**Deadline:** {scheme['deadline']}\")\n                \n                if scheme.get('contact_info'):\n                    st.write(f\"**Contact:** {scheme['contact_info']}\")\n    \n    except FileNotFoundError:\n        st.error(\"Schemes database not found. Please contact administrator.\")\n    except Exception as e:\n        st.error(f\"Error loading schemes: {str(e)}\")\n\nelif st.session_state.current_section == \"Crop Advisory\":\n    st.header(\"üåæ Crop Advisory System\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        season = st.selectbox(\n            \"Select Current Season\",\n            [\"Kharif (Monsoon)\", \"Rabi (Winter)\", \"Zaid (Summer)\"]\n        )\n    \n    with col2:\n        soil_type = st.selectbox(\n            \"Select Soil Type\",\n            [\"Loamy\", \"Clay\", \"Sandy\", \"Red Soil\", \"Black Soil\", \"Alluvial\"]\n        )\n    \n    if st.button(\"Get Crop Recommendations\"):\n        recommendations = get_crop_recommendation(season, soil_type, \"Kerala\")\n        \n        st.subheader(\"üå± Recommended Crops\")\n        \n        for crop in recommendations['primary_crops']:\n            st.success(f\"üåæ **{crop['name']}** - {crop['reason']}\")\n        \n        if recommendations['secondary_crops']:\n            st.subheader(\"Alternative Crops\")\n            for crop in recommendations['secondary_crops']:\n                st.info(f\"üåø **{crop['name']}** - {crop['reason']}\")\n        \n        # Additional tips\n        st.subheader(\"üßë‚Äçüåæ Farming Tips\")\n        for tip in recommendations['tips']:\n            st.write(f\"‚Ä¢ {tip}\")\n\nelif st.session_state.current_section == \"News Feed\":\n    st.header(\"üì∞ Agriculture News Feed\")\n    \n    try:\n        news_items = get_agriculture_news()\n        \n        if news_items:\n            for news in news_items:\n                with st.container():\n                    st.subheader(news['title'])\n                    st.write(news['description'])\n                    \n                    col1, col2 = st.columns([3, 1])\n                    with col1:\n                        st.write(f\"**Source:** {news['source']}\")\n                    with col2:\n                        if news.get('url'):\n                            st.markdown(f\"[Read More]({news['url']})\")\n                    \n                    st.divider()\n        else:\n            st.info(\"No news items available at the moment. Please check back later.\")\n            \n    except Exception as e:\n        st.error(f\"Error loading news: {str(e)}\")\n\nelif st.session_state.current_section == \"Login\":\n    st.header(\"üîê Login / Signup\")\n    \n    tab1, tab2 = st.tabs([\"Login\", \"Sign Up\"])\n    \n    with tab1:\n        st.subheader(\"Login to Your Account\")\n        mobile = st.text_input(\"Mobile Number\", key=\"login_mobile\", max_chars=10)\n        password = st.text_input(\"Password\", type=\"password\", key=\"login_password\")\n        \n        if st.button(\"Login\"):\n            if mobile and password:\n                success, result = login_user(mobile, password)\n                if success:\n                    st.session_state.authenticated = True\n                    st.session_state.user_mobile = mobile\n                    st.session_state.user_data = result\n                    st.success(\"Login successful!\")\n                    st.session_state.current_section = \"Farming Calendar\"\n                    st.rerun()\n                else:\n                    st.error(result)\n            else:\n                st.warning(\"Please enter mobile number and password\")\n    \n    with tab2:\n        st.subheader(\"Create New Account\")\n        name = st.text_input(\"Full Name\", key=\"signup_name\")\n        location = st.text_input(\"Location (Village, District, State)\", key=\"signup_location\")\n        mobile_signup = st.text_input(\"Mobile Number\", key=\"signup_mobile\", max_chars=10)\n        password_signup = st.text_input(\"Password\", type=\"password\", key=\"signup_password\")\n        confirm_password = st.text_input(\"Confirm Password\", type=\"password\", key=\"signup_confirm\")\n        \n        if st.button(\"Sign Up\"):\n            if name and location and mobile_signup and password_signup:\n                if password_signup == confirm_password:\n                    success, message = register_user(name, location, mobile_signup, password_signup)\n                    if success:\n                        st.success(message + \" Please login now.\")\n                    else:\n                        st.error(message)\n                else:\n                    st.error(\"Passwords do not match\")\n            else:\n                st.warning(\"Please fill all fields\")\n\nelif st.session_state.current_section == \"Market Prices\":\n    st.header(\"üìà Market Prices\")\n    \n    try:\n        market_data = get_market_prices(\"Kerala\")\n        \n        st.subheader(f\"üìä Live Market Prices - {market_data['state']}\")\n        st.caption(f\"Last Updated: {market_data['last_updated']}\")\n        \n        # Display prices in cards\n        cols = st.columns(3)\n        for idx, (crop_name, crop_data) in enumerate(market_data['prices'].items()):\n            with cols[idx % 3]:\n                trend_emoji = \"üìà\" if crop_data['trend'] == 'up' else (\"üìâ\" if crop_data['trend'] == 'down' else \"‚û°Ô∏è\")\n                \n                st.metric(\n                    label=f\"{trend_emoji} {crop_name}\",\n                    value=f\"‚Çπ{crop_data['modal_price']} / {crop_data['unit']}\",\n                    delta=crop_data['change']\n                )\n                st.caption(f\"Market: {crop_data['market']}\")\n        \n        st.divider()\n        \n        # Market Insights\n        st.subheader(\"üí° Market Insights\")\n        insights = get_market_insights(\"Kerala\")\n        \n        for insight in insights:\n            impact_color = \"green\" if insight['impact'] == 'positive' else (\"red\" if insight['impact'] == 'negative' else \"blue\")\n            st.markdown(f\"**{insight['title']}**\")\n            st.markdown(f\"<p style='color: {impact_color};'>{insight['description']}</p>\", unsafe_allow_html=True)\n            st.caption(f\"Affects: {', '.join(insight['crops'])}\")\n            st.divider()\n        \n        # Best Selling Time\n        st.subheader(\"‚è∞ Best Time to Sell\")\n        selected_crop = st.selectbox(\"Select Crop\", list(market_data['prices'].keys()))\n        \n        if selected_crop:\n            selling_advice = get_best_selling_time(selected_crop)\n            st.info(f\"**Best Months:** {selling_advice['best_months']}\")\n            st.write(f\"**Reason:** {selling_advice['reason']}\")\n            st.success(f\"**Advice:** {selling_advice['advice']}\")\n            \n    except Exception as e:\n        st.error(f\"Error loading market prices: {str(e)}\")\n\nelif st.session_state.current_section == \"Farming Calendar\":\n    if not st.session_state.authenticated:\n        st.warning(\"Please login to access your farming calendar\")\n        st.stop()\n    \n    st.header(\"üìÖ My Farming Calendar\")\n    \n    # Tabs for different features\n    tab1, tab2, tab3 = st.tabs([\"My Crops\", \"Add New Crop\", \"Upcoming Tasks\"])\n    \n    with tab1:\n        st.subheader(\"üåæ My Crops\")\n        user_crops = st.session_state.user_data.get('crops', [])\n        \n        if user_crops:\n            for crop in user_crops:\n                with st.expander(f\"üå± {crop['name']} - {crop['area_acres']} acres\"):\n                    calendar = get_crop_calendar(crop['name'], crop['planting_date'])\n                    \n                    st.write(f\"**Planting Date:** {crop['planting_date']}\")\n                    st.write(f\"**Expected Harvest:** {calendar['harvest_date']}\")\n                    st.write(f\"**Total Duration:** {calendar['total_duration']} days\")\n                    \n                    st.subheader(\"Growth Stages\")\n                    for stage in calendar['timeline']:\n                        st.write(f\"**{stage['stage']}** ({stage['start_date']} to {stage['end_date']})\")\n                        st.write(f\"Activities: {', '.join(stage['activities'])}\")\n                        st.divider()\n                    \n                    st.subheader(\"Fertilizer Schedule\")\n                    for fert in calendar['fertilizer_schedule']:\n                        st.info(f\"**{fert['date']}** - {fert['fertilizer']} ({fert['stage']})\")\n        else:\n            st.info(\"No crops added yet. Add your first crop in the 'Add New Crop' tab!\")\n    \n    with tab2:\n        st.subheader(\"üå± Add New Crop\")\n        \n        crop_name = st.selectbox(\n            \"Select Crop\",\n            [\"Rice (Paddy)\", \"Coconut\", \"Pepper\", \"Banana\", \"Cardamom\", \"Ginger\", \"Turmeric\"]\n        )\n        \n        planting_date = st.date_input(\"Planting Date\", value=datetime.now())\n        area_acres = st.number_input(\"Area (in acres)\", min_value=0.1, max_value=100.0, value=1.0, step=0.5)\n        \n        if st.button(\"Add Crop\"):\n            success = add_crop_to_user(\n                st.session_state.user_mobile,\n                crop_name,\n                planting_date.isoformat(),\n                area_acres\n            )\n            if success:\n                st.session_state.user_data = get_user_data(st.session_state.user_mobile)\n                st.success(f\"{crop_name} added successfully!\")\n                st.rerun()\n            else:\n                st.error(\"Failed to add crop\")\n    \n    with tab3:\n        st.subheader(\"üìã Upcoming Tasks (Next 7 Days)\")\n        \n        upcoming = get_upcoming_tasks(st.session_state.user_mobile, days=7)\n        \n        if upcoming:\n            for task in upcoming:\n                days_text = \"Today\" if task['days_until'] == 0 else f\"In {task['days_until']} days\"\n                \n                if task['type'] == 'fertilizer':\n                    st.warning(f\"**{task['title']}** - {days_text}\")\n                elif task['type'] == 'stage':\n                    st.info(f\"**{task['title']}** - {days_text}\")\n                else:\n                    st.success(f\"**{task['title']}** - {days_text}\")\n                \n                st.write(task['description'])\n                st.caption(f\"Date: {task['date']}\")\n                st.divider()\n        else:\n            st.info(\"No upcoming tasks in the next 7 days\")\n        \n        # Add custom reminder\n        st.subheader(\"‚ûï Add Custom Reminder\")\n        reminder_title = st.text_input(\"Reminder Title\")\n        reminder_date = st.date_input(\"Reminder Date\")\n        reminder_desc = st.text_area(\"Description (optional)\")\n        \n        if st.button(\"Add Reminder\"):\n            if reminder_title:\n                success = add_reminder(\n                    st.session_state.user_mobile,\n                    {\n                        'title': reminder_title,\n                        'date': reminder_date.isoformat(),\n                        'description': reminder_desc\n                    }\n                )\n                if success:\n                    st.session_state.user_data = get_user_data(st.session_state.user_mobile)\n                    st.success(\"Reminder added!\")\n                    st.rerun()\n\n# Footer\nst.markdown(\"---\")\nst.markdown(\"\"\"\n<div style=\"text-align: center; color: #666; padding: 20px;\">\n    <p>üåæ Krishi Mitra AI - Empowering Farmers with Technology</p>\n    <p>For support, contact: krishimitra@support.gov.in</p>\n</div>\n\"\"\", unsafe_allow_html=True)\n","size_bytes":27991},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"google-genai>=1.41.0\",\n    \"pyaudio>=0.2.14\",\n    \"requests>=2.32.5\",\n    \"speechrecognition>=3.14.3\",\n    \"streamlit>=1.50.0\",\n]\n","size_bytes":277},"utils/gemini_helper.py":{"content":"import os\nimport json\nfrom google import genai\nfrom google.genai import types\n\n# Initialize Gemini client\nclient = genai.Client(api_key=os.getenv(\"GEMINI_API_KEY\", \"default_key\"))\n\ndef ask_gemini(query, language=\"en\"):\n    \"\"\"\n    Ask Gemini AI a farming-related question with multilingual support\n    \"\"\"\n    try:\n        # Language codes mapping\n        lang_map = {\n            \"en\": \"English\",\n            \"ml\": \"Malayalam\", \n            \"hi\": \"Hindi\",\n            \"mr\": \"Marathi\"\n        }\n        \n        target_language = lang_map.get(language, \"English\")\n        \n        # Create a comprehensive farming assistant prompt\n        system_prompt = f\"\"\"\n        You are Krishi Mitra AI, an expert agricultural assistant for Indian farmers. \n        You have deep knowledge of:\n        - Indian crops, seasons (Kharif, Rabi, Zaid)\n        - Soil types common in India\n        - Pest and disease management\n        - Government schemes and subsidies\n        - Weather-based farming advice\n        - Sustainable farming practices\n        - Market prices and trends\n        - Fertilizer and seed recommendations\n        \n        Always provide:\n        1. Practical, actionable advice\n        2. Context-specific recommendations for Indian conditions\n        3. Cost-effective solutions\n        4. Traditional knowledge combined with modern techniques\n        \n        Respond in {target_language}. If the user asks in a different language, detect it and respond in that language.\n        Keep responses informative yet concise (200-300 words max).\n        \"\"\"\n        \n        response = client.models.generate_content(\n            model=\"gemini-2.5-flash\",\n            contents=[\n                types.Content(role=\"user\", parts=[types.Part(text=query)])\n            ],\n            config=types.GenerateContentConfig(\n                system_instruction=system_prompt,\n            ),\n        )\n        \n        return response.text or \"I apologize, but I couldn't process your query at the moment. Please try again.\"\n        \n    except Exception as e:\n        return f\"Error: Unable to get AI response. Please check your internet connection and try again. ({str(e)})\"\n\ndef analyze_image_for_disease(image_path, language=\"en\"):\n    \"\"\"\n    Analyze crop image for disease detection using Gemini Vision\n    \"\"\"\n    try:\n        lang_map = {\n            \"en\": \"English\",\n            \"ml\": \"Malayalam\", \n            \"hi\": \"Hindi\",\n            \"mr\": \"Marathi\"\n        }\n        \n        target_language = lang_map.get(language, \"English\")\n        \n        with open(image_path, \"rb\") as f:\n            image_bytes = f.read()\n            \n        system_prompt = f\"\"\"\n        You are an expert plant pathologist specializing in crop diseases common in India.\n        Analyze this image and provide:\n        1. Crop identification if possible\n        2. Disease/pest identification\n        3. Severity level (Mild/Moderate/Severe)\n        4. Immediate treatment recommendations\n        5. Prevention measures\n        6. Organic/chemical treatment options\n        \n        Focus on diseases common in Indian agriculture.\n        Respond in {target_language}.\n        If you cannot identify any disease, suggest general plant health tips.\n        \"\"\"\n        \n        response = client.models.generate_content(\n            model=\"gemini-2.5-pro\",\n            contents=[\n                types.Part.from_bytes(\n                    data=image_bytes,\n                    mime_type=\"image/jpeg\",\n                ),\n                system_prompt\n            ],\n        )\n        \n        return response.text or \"Unable to analyze the image. Please ensure the image is clear and shows the affected plant parts.\"\n        \n    except Exception as e:\n        return f\"Error analyzing image: {str(e)}\"\n\ndef translate_text(text, target_language):\n    \"\"\"\n    Translate text to target language using Gemini\n    \"\"\"\n    try:\n        lang_map = {\n            \"en\": \"English\",\n            \"ml\": \"Malayalam\", \n            \"hi\": \"Hindi\",\n            \"mr\": \"Marathi\"\n        }\n        \n        target_lang = lang_map.get(target_language, \"English\")\n        \n        prompt = f\"Translate the following text to {target_lang}. Keep agricultural terms accurate:\\n\\n{text}\"\n        \n        response = client.models.generate_content(\n            model=\"gemini-2.5-flash\",\n            contents=prompt\n        )\n        \n        return response.text or text\n        \n    except Exception as e:\n        return text  # Return original text if translation fails\n","size_bytes":4528},"utils/market_prices.py":{"content":"import requests\nfrom datetime import datetime, timedelta\nimport random\n\ndef get_market_prices(state=\"Kerala\"):\n    \"\"\"\n    Get current market prices for agricultural commodities\n    Uses AgMarkNet API or fallback to realistic data structure\n    \"\"\"\n    \n    # Real market price structure with realistic variations\n    crops_data = {\n        'Kerala': {\n            'Rice (Paddy)': {\n                'unit': 'Quintal',\n                'min_price': 2650,\n                'max_price': 2950,\n                'modal_price': 2800,\n                'trend': 'stable',\n                'change': '+1.5%',\n                'market': 'Palakkad Mandi'\n            },\n            'Coconut': {\n                'unit': '100 Nuts',\n                'min_price': 1750,\n                'max_price': 1950,\n                'modal_price': 1850,\n                'trend': 'up',\n                'change': '+5.2%',\n                'market': 'Thrissur Market'\n            },\n            'Pepper': {\n                'unit': 'Kg',\n                'min_price': 465,\n                'max_price': 510,\n                'modal_price': 485,\n                'trend': 'down',\n                'change': '-2.1%',\n                'market': 'Kochi Spice Market'\n            },\n            'Cardamom': {\n                'unit': 'Kg',\n                'min_price': 1200,\n                'max_price': 1350,\n                'modal_price': 1280,\n                'trend': 'up',\n                'change': '+3.8%',\n                'market': 'Kumily Market'\n            },\n            'Ginger': {\n                'unit': 'Quintal',\n                'min_price': 7800,\n                'max_price': 8600,\n                'modal_price': 8200,\n                'trend': 'stable',\n                'change': '+0.8%',\n                'market': 'Wayanad Market'\n            },\n            'Turmeric': {\n                'unit': 'Quintal',\n                'min_price': 7400,\n                'max_price': 8200,\n                'modal_price': 7800,\n                'trend': 'up',\n                'change': '+2.3%',\n                'market': 'Ernakulam Mandi'\n            },\n            'Banana': {\n                'unit': 'Dozen',\n                'min_price': 35,\n                'max_price': 45,\n                'modal_price': 40,\n                'trend': 'stable',\n                'change': '+0.5%',\n                'market': 'Trivandrum Market'\n            },\n            'Rubber': {\n                'unit': 'Kg',\n                'min_price': 168,\n                'max_price': 185,\n                'modal_price': 175,\n                'trend': 'down',\n                'change': '-1.2%',\n                'market': 'Kottayam Market'\n            },\n            'Arecanut': {\n                'unit': 'Quintal',\n                'min_price': 28500,\n                'max_price': 32000,\n                'modal_price': 30500,\n                'trend': 'up',\n                'change': '+4.2%',\n                'market': 'Kasaragod Market'\n            },\n            'Tapioca': {\n                'unit': 'Quintal',\n                'min_price': 1200,\n                'max_price': 1450,\n                'modal_price': 1350,\n                'trend': 'stable',\n                'change': '+1.1%',\n                'market': 'Kollam Market'\n            }\n        }\n    }\n    \n    state_data = crops_data.get(state, crops_data['Kerala'])\n    \n    # Add slight random variation to simulate live prices\n    for crop in state_data:\n        base_price = state_data[crop]['modal_price']\n        variation = random.uniform(-0.02, 0.02)  # ¬±2% variation\n        state_data[crop]['modal_price'] = int(base_price * (1 + variation))\n    \n    return {\n        'state': state,\n        'last_updated': datetime.now().strftime('%Y-%m-%d %H:%M'),\n        'prices': state_data\n    }\n\ndef get_price_trend(crop_name, days=7):\n    \"\"\"Get price trend for a crop over specified days\"\"\"\n    trend_data = []\n    base_price = 1000\n    \n    for i in range(days):\n        date = (datetime.now() - timedelta(days=days-i-1)).strftime('%Y-%m-%d')\n        price = base_price + random.randint(-100, 100)\n        trend_data.append({\n            'date': date,\n            'price': price\n        })\n    \n    return trend_data\n\ndef get_market_insights(state=\"Kerala\"):\n    \"\"\"Get market insights and predictions\"\"\"\n    insights = {\n        'Kerala': [\n            {\n                'title': 'Coconut Prices Rising',\n                'description': 'Due to increased demand for coconut oil, prices expected to rise 3-5% in next week',\n                'impact': 'positive',\n                'crops': ['Coconut']\n            },\n            {\n                'title': 'Pepper Export Demand High',\n                'description': 'International demand for black pepper is strong, good time for farmers to sell',\n                'impact': 'positive',\n                'crops': ['Pepper']\n            },\n            {\n                'title': 'Monsoon Impact on Rice',\n                'description': 'Good monsoon expected to increase paddy supply, prices may stabilize',\n                'impact': 'neutral',\n                'crops': ['Rice (Paddy)']\n            },\n            {\n                'title': 'Cardamom Market Bullish',\n                'description': 'Limited supply and high demand driving cardamom prices up',\n                'impact': 'positive',\n                'crops': ['Cardamom']\n            }\n        ]\n    }\n    \n    return insights.get(state, insights['Kerala'])\n\ndef get_best_selling_time(crop_name):\n    \"\"\"Suggest best time to sell based on historical patterns\"\"\"\n    selling_advice = {\n        'Rice (Paddy)': {\n            'best_months': ['November', 'December', 'January'],\n            'reason': 'Post-harvest demand is high during festive season',\n            'advice': 'Store properly and sell during peak demand months'\n        },\n        'Coconut': {\n            'best_months': ['Year-round with peak in April-June'],\n            'reason': 'Summer months see increased demand for coconut water',\n            'advice': 'Prices peak during summer, good time to sell'\n        },\n        'Pepper': {\n            'best_months': ['October', 'November', 'December'],\n            'reason': 'Festival season and export demand drives prices',\n            'advice': 'Hold stock till export season begins'\n        },\n        'Cardamom': {\n            'best_months': ['October', 'November'],\n            'reason': 'Festive season demand from domestic and export markets',\n            'advice': 'Peak prices during Diwali season'\n        }\n    }\n    \n    return selling_advice.get(crop_name, {\n        'best_months': ['Check market trends'],\n        'reason': 'Market conditions vary',\n        'advice': 'Monitor prices regularly for best returns'\n    })\n","size_bytes":6744},"utils/news_helper.py":{"content":"import requests\nimport json\nimport os\nfrom datetime import datetime, timedelta\n\ndef get_agriculture_news():\n    \"\"\"\n    Fetch agriculture-related news (using NewsAPI or fallback to hardcoded)\n    \"\"\"\n    try:\n        # Try to fetch from NewsAPI if available\n        news_items = fetch_news_from_api()\n        \n        if not news_items:\n            # Fallback to curated agriculture news\n            news_items = get_fallback_news()\n        \n        return news_items\n    \n    except Exception as e:\n        # Return fallback news in case of any error\n        return get_fallback_news()\n\ndef fetch_news_from_api():\n    \"\"\"\n    Fetch news from NewsAPI (if API key is available)\n    \"\"\"\n    try:\n        api_key = os.getenv(\"NEWS_API_KEY\", \"\")\n        \n        if not api_key or api_key == \"default_key\":\n            return None\n        \n        base_url = \"https://newsapi.org/v2/everything\"\n        \n        params = {\n            'q': 'agriculture OR farming OR crops OR farmers India',\n            'language': 'en',\n            'sortBy': 'publishedAt',\n            'pageSize': 10,\n            'apiKey': api_key\n        }\n        \n        response = requests.get(base_url, params=params, timeout=10)\n        \n        if response.status_code == 200:\n            data = response.json()\n            news_items = []\n            \n            for article in data['articles'][:8]:  # Get top 8 articles\n                news_item = {\n                    'title': article['title'],\n                    'description': article['description'] or 'No description available',\n                    'source': article['source']['name'],\n                    'published_at': article['publishedAt'],\n                    'url': article['url']\n                }\n                news_items.append(news_item)\n            \n            return news_items\n        \n        return None\n    \n    except Exception:\n        return None\n\ndef get_fallback_news():\n    \"\"\"\n    Fallback agriculture news when API is not available\n    \"\"\"\n    current_date = datetime.now().strftime(\"%Y-%m-%d\")\n    \n    news_items = [\n        {\n            'title': 'Digital Agriculture Initiatives Boost Farmer Incomes Across India',\n            'description': 'Government launches new digital platforms to connect farmers directly with markets, eliminating middlemen and increasing profits by 30%.',\n            'source': 'Ministry of Agriculture',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'Monsoon 2024: IMD Predicts Normal Rainfall for Kerala',\n            'description': 'Indian Meteorological Department forecasts favorable monsoon conditions for Kerala, benefiting rice and spice cultivation.',\n            'source': 'India Meteorological Department',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'New High-Yield Rice Varieties Released for Coastal States',\n            'description': 'ICAR develops salt-tolerant rice varieties specifically for coastal regions, promising 20% higher yields.',\n            'source': 'Indian Council of Agricultural Research',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'PM-KISAN Benefits Reach 12 Crore Farmers',\n            'description': 'Direct benefit transfer scheme successfully provides financial support to millions of small and marginal farmers.',\n            'source': 'Press Information Bureau',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'Organic Farming: Kerala Leads in Sustainable Agriculture',\n            'description': 'Kerala state government announces incentives for organic farming, aiming to become fully organic by 2025.',\n            'source': 'Kerala Agricultural Department',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'Drone Technology Revolutionizes Crop Monitoring',\n            'description': 'Farmers increasingly adopt drone technology for pest surveillance and precision agriculture applications.',\n            'source': 'Agriculture Technology Today',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'Coconut Prices Show Upward Trend in South Indian Markets',\n            'description': 'Increased demand for coconut products drives prices up, benefiting coconut farmers in Kerala and Karnataka.',\n            'source': 'Coconut Development Board',\n            'published_at': current_date,\n            'url': '#'\n        },\n        {\n            'title': 'Climate-Smart Agriculture Practices Gain Momentum',\n            'description': 'Farmers adopt climate-resilient techniques to combat changing weather patterns and ensure sustainable production.',\n            'source': 'National Sample Survey Office',\n            'published_at': current_date,\n            'url': '#'\n        }\n    ]\n    \n    return news_items\n\ndef get_market_prices():\n    \"\"\"\n    Get current market prices for major agricultural commodities\n    \"\"\"\n    # This would typically fetch from an API like eNAM or commodity exchange\n    # For now, returning sample data structure\n    \n    market_data = {\n        'last_updated': datetime.now().strftime('%Y-%m-%d %H:%M'),\n        'prices': {\n            'Rice (Per Quintal)': {\n                'price': '‚Çπ2,850',\n                'change': '+2.5%',\n                'trend': 'up'\n            },\n            'Coconut (Per 1000 nuts)': {\n                'price': '‚Çπ18,500',\n                'change': '+5.2%', \n                'trend': 'up'\n            },\n            'Pepper (Per Kg)': {\n                'price': '‚Çπ485',\n                'change': '-1.8%',\n                'trend': 'down'\n            },\n            'Cardamom (Per Kg)': {\n                'price': '‚Çπ1,250',\n                'change': '+3.1%',\n                'trend': 'up'\n            },\n            'Ginger (Per Quintal)': {\n                'price': '‚Çπ8,200',\n                'change': '+0.5%',\n                'trend': 'stable'\n            },\n            'Turmeric (Per Quintal)': {\n                'price': '‚Çπ7,800',\n                'change': '+1.2%',\n                'trend': 'up'\n            }\n        }\n    }\n    \n    return market_data\n\ndef get_weather_alerts():\n    \"\"\"\n    Get weather-based farming alerts\n    \"\"\"\n    alerts = []\n    \n    # This would typically integrate with weather services\n    # Sample alerts based on common scenarios\n    \n    sample_alerts = [\n        {\n            'type': 'info',\n            'title': 'Favorable Conditions',\n            'message': 'Current weather conditions are ideal for rice transplanting in Kerala.',\n            'priority': 'low'\n        },\n        {\n            'type': 'warning', \n            'title': 'Heavy Rain Alert',\n            'message': 'Heavy rainfall expected in next 48 hours. Secure harvested crops and ensure drainage.',\n            'priority': 'high'\n        },\n        {\n            'type': 'advisory',\n            'title': 'Pest Management',\n            'message': 'High humidity conditions favor fungal diseases. Monitor crops closely.',\n            'priority': 'medium'\n        }\n    ]\n    \n    return sample_alerts\n","size_bytes":7281},"utils/weather_helper.py":{"content":"import requests\nimport os\nfrom datetime import datetime\n\ndef get_weather_data(location):\n    \"\"\"\n    Fetch weather data from OpenWeatherMap API\n    \"\"\"\n    try:\n        api_key = os.getenv(\"OPENWEATHER_API_KEY\", \"default_key\")\n        base_url = \"http://api.openweathermap.org/data/2.5/weather\"\n        \n        params = {\n            'q': location,\n            'appid': api_key,\n            'units': 'metric'  # Celsius\n        }\n        \n        response = requests.get(base_url, params=params, timeout=10)\n        \n        if response.status_code == 200:\n            data = response.json()\n            \n            weather_info = {\n                'temperature': round(data['main']['temp']),\n                'feels_like': round(data['main']['feels_like']),\n                'humidity': data['main']['humidity'],\n                'pressure': data['main']['pressure'],\n                'description': data['weather'][0]['description'].title(),\n                'wind_speed': round(data['wind']['speed'] * 3.6, 1),  # Convert m/s to km/h\n                'visibility': data.get('visibility', 0) / 1000,  # Convert to km\n                'cloud_cover': data['clouds']['all'],\n                'sunrise': datetime.fromtimestamp(data['sys']['sunrise']).strftime('%H:%M'),\n                'sunset': datetime.fromtimestamp(data['sys']['sunset']).strftime('%H:%M'),\n            }\n            \n            # Check if rainfall data is available\n            if 'rain' in data:\n                weather_info['rainfall'] = data['rain'].get('1h', 0)  # Last 1 hour\n            else:\n                weather_info['rainfall'] = 0\n                \n            return weather_info\n            \n        else:\n            return None\n            \n    except requests.exceptions.Timeout:\n        raise Exception(\"Weather service timeout. Please try again.\")\n    except requests.exceptions.ConnectionError:\n        raise Exception(\"Unable to connect to weather service. Check internet connection.\")\n    except Exception as e:\n        raise Exception(f\"Error fetching weather data: {str(e)}\")\n\ndef get_weather_forecast(location, days=5):\n    \"\"\"\n    Get weather forecast for specified number of days\n    \"\"\"\n    try:\n        api_key = os.getenv(\"OPENWEATHER_API_KEY\", \"default_key\")\n        base_url = \"http://api.openweathermap.org/data/2.5/forecast\"\n        \n        params = {\n            'q': location,\n            'appid': api_key,\n            'units': 'metric',\n            'cnt': days * 8  # 8 forecasts per day (every 3 hours)\n        }\n        \n        response = requests.get(base_url, params=params, timeout=10)\n        \n        if response.status_code == 200:\n            data = response.json()\n            forecast = []\n            \n            for item in data['list']:\n                forecast_item = {\n                    'datetime': datetime.fromtimestamp(item['dt']),\n                    'temperature': round(item['main']['temp']),\n                    'humidity': item['main']['humidity'],\n                    'description': item['weather'][0]['description'].title(),\n                    'wind_speed': round(item['wind']['speed'] * 3.6, 1),\n                    'rainfall': item.get('rain', {}).get('3h', 0)\n                }\n                forecast.append(forecast_item)\n            \n            return forecast\n        else:\n            return None\n            \n    except Exception as e:\n        raise Exception(f\"Error fetching weather forecast: {str(e)}\")\n\ndef get_farming_weather_advisory(weather_data):\n    \"\"\"\n    Generate farming advisory based on weather conditions\n    \"\"\"\n    advisories = []\n    \n    if weather_data['temperature'] > 35:\n        advisories.append(\"üå°Ô∏è High temperature detected. Increase irrigation frequency and provide shade for sensitive crops.\")\n    \n    if weather_data['temperature'] < 10:\n        advisories.append(\"ü•∂ Low temperature warning. Protect crops from frost damage.\")\n    \n    if weather_data['humidity'] > 85:\n        advisories.append(\"üíß High humidity levels. Monitor for fungal diseases and improve air circulation.\")\n    \n    if weather_data['humidity'] < 30:\n        advisories.append(\"üèúÔ∏è Low humidity. Increase irrigation and consider mulching.\")\n    \n    if weather_data['rainfall'] > 50:\n        advisories.append(\"üåßÔ∏è Heavy rainfall expected. Ensure proper drainage and harvest ready crops.\")\n    \n    if weather_data['wind_speed'] > 25:\n        advisories.append(\"üí® Strong winds expected. Secure tall crops and protect seedlings.\")\n    \n    if not advisories:\n        advisories.append(\"üå± Weather conditions are favorable for normal farming activities.\")\n    \n    return advisories\n","size_bytes":4652}},"version":2}